# OLA trigger config to control Uyuni Lighting LED candles using a Broadlink RM 3/4 Mini device
# https://uyunilighting.com
# https://www.ibroadlink.com
# Copyright (C) 2023 Johan Nilsson. https://gobo.ws



# DMX chart

###########################################################################

# +---------+---------+---------------------------------------------------+
# | Channel | Value   | Function                                          |
# +---------+---------+---------------------------------------------------+
# | 1       | 0-63    | Off                                               |
# | 1       | 64-127  | On                                                |
# | 1       | 128-191 | Brightness - (3 steps, low, medium and high)      |
# | 1       | 192-255 | Brightness +                                      |
# +---------+---------+---------------------------------------------------+
# | 2       | 0-51    | Unused range                                      |
# | 2       | 52-102  | Timer 4 h                                         |
# | 2       | 103-153 | Timer 6 h                                         |
# | 2       | 154-204 | Timer 8 h                                         |
# | 2       | 205-255 | Timer 10 h                                        |
# +---------+---------+---------------------------------------------------+


# Comments

###########################################################################

# It seems that installing the node "simple-broadlink" via the palette in Node-RED is not functioning correctly. 
# Install it from the terminal in your .node-red directory using the following command:
# npm install --no-audit --no-update-notifier --no-fund --save --save-prefix=~ --omit=dev --engine-strict node-red-contrib-simple-broadlink@0.0.8
# Do not forget to edit the hostname/IP address to your Broadlink device in the Node-RED flow. 



# Configuration

###########################################################################

url='https://localhost:1880'      # Node-RED URL

# Broadlink RM 3/4 Mini IR HEX codes (do not edit these codes)
off='26008c00133714121411141214111412141115111412123814371436153614371337143714111437141213121412141114121411143714121337143714361437143615361400051400012f931536141114121313131213131411151113121338133812381338143615361535151115361411151114111511141115111436151112381536143615361436133814000d05000000000000000000000000'
on='2600900000012994143613121313131215111312151113121313123813381238153614361338123813131411151114111511131215111312133814361338143615361536123815361200051600012d931437141213121511131214111412141113131436143714361437143614371435151214111412141114121411141213121536133714371337143713371437133714000d050000000000000000'
b-minus='2600900000012d90163714121411141214121412141114121412123814371436143714351537143714121337141213371412131214121411143713121437131214371436143713371300051500012d931436131312131412131214111412121313121338143614371337143714361337141213371313133714111412141114121337131214371411133813371436143713000d050000000000000000'
b-plus='2600900000012a93143713121411141214111412131214111412143614371337143614371436143713371437131214361412131214111412141114121337131214371337143614371300051400012e931436141214111412131215111411141114121436143714361437143614361437143614371411143713121411141214111412131214361412143614371436143714000d050000000000000000'
t4h='2600900000012c92143714121411131314111412141113131412123814371337143714361437133813121412123814121312141214111412143614371411133814371337133812381400051400012e931437131313121313131214121313121313121338123814371238133814361436151114121436131314121213141212131436143714111437143614371338123813000d050000000000000000'
t6h='2600940000012e93143613131412131214121412141114121411133814371535143714371436153614111412131314361412141214111313143614371437141114371437143615361400051400012f9314371312131315101412141213121412131214371337143714361338143614371412131214121238141213121412131214371238143713121437133714371436130005e90a000d0500000000'
t8h='2600900000012d93143615111412141115111412131214121412143614371437143614371437143614121411143714371411161014121411143714371411141214361437143714361400051400012e931436141213121412131214111412141114121436143714361437143614371436151114111437143614121411141214121337143713121412143614371436143713000d050000000000000000'
t10h='2600900000012d93143614121312141212131312141214111412133714361536143614371436143713121411141214111437141114111412133714361437143614121337143613381400051300012d9313371411141214111412131215101412190c1436143713371437143614371436141213121411141214361412131214111437143614371436141213371436143714000d050000000000000000'



# Triggers

###########################################################################
# Slot  Values   Action

1        0-63      -`curl '-m' '2' '-s' '-o /dev/null' '-k' '${url}/ir-remote?code=${off}'`
1        64-127    +`curl '-m' '2' '-s' '-o /dev/null' '-k' '${url}/ir-remote?code=${on}'`
1        128-191    `curl '-m' '2' '-s' '-o /dev/null' '-k' '${url}/ir-remote?code=${b-minus}'`
1        192-255    `curl '-m' '2' '-s' '-o /dev/null' '-k' '${url}/ir-remote?code=${b-plus}'`
2        52-102     `curl '-m' '2' '-s' '-o /dev/null' '-k' '${url}/ir-remote?code=${t4h}'`
2        103-153    `curl '-m' '2' '-s' '-o /dev/null' '-k' '${url}/ir-remote?code=${t6h}'`
2        154-204    `curl '-m' '2' '-s' '-o /dev/null' '-k' '${url}/ir-remote?code=${t8h}'`
2        205-255    `curl '-m' '2' '-s' '-o /dev/null' '-k' '${url}/ir-remote?code=${t10h}'`
